<style type="text/css"> 
  html {  
    background: url('http://i.imgur.com/OwekIWV.jpg'); 
    background-attachment: fixed;
    background-position: center center;
  } 

  body {
    background: transparent;
  }
</style> 
           
            


<script type="text/javascript">
  var TOPICS = '<%- topicSlug %>';
  var TREEJSON = JSON.parse(<%- JSON.stringify(tree) %>);
  var DEBUG = true;
</script>

<script type="text/javascript" src="/js/Convoset.js"></script>
<script type="text/javascript" src="/js/PostsController.js"></script>






<div id="posts" ng-controller="PostsController">

  <!--                    -->
  <!--     Forum View     -->
  <!--                    -->

  <div id="forumView" ng-if="view==='forum'">

    <input id="query" type="search" ng-model="search.query"></input>

    <ul>
      <li ng-repeat="convo in posts" ng-include="'forumRenderer'"></li>
    </ul>



    <script type="text/ng-template" id="forumRenderer">
      <div class="post slidehide colorhide" ng-hide="convo.filtered" id="forum{{convo.token}}" ng-class="{selected: convo.selected}" ng-Click="select(convo, 'forum')">

        <h2 ng-if="convo.type === 'Root'"><a href="{{convo.link}}">{{convo.title}}</a></h2>

        <div class="details">
          <h3>{{convo.author}}</h3>
          <h4>{{convo.time}}</h4>
        </div>

        <p class="quote" ng-if="convo.type === 'Branch'" ng-Click="select(convo.parent, 'forum'); $event.stopPropagation()">{{convo.parent.contents | limitTo:120}}...</p>
        <p>{{convo.contents}}</p>

        <form ng-submit="reply(convo)" class="forumReply slideableH" ng-slide="convo.selected">
          <textarea ng-model="convo.response" ng-enter="reply(convo)"></textarea>
        </form>

      </div>
    </script>
  </div>


  <!--                     -->
  <!--      Tree View      -->
  <!--                     -->

  <div class="treeView" ng-if="view==='tree'">
    <ul>
      <li ng-repeat="convo in roots" ng-include="'treeRenderer'"></li>
    </ul>
  </div>


  <script type="text/ng-template" id="treeRenderer">
    <div class="treeView">

      <div class="bracket" ng-if="convo.type!=='Root'" ng-class="{leftBracket: $first, rightBracket: $last}"></div>

      <div class="node" id="tree{{convo.token}}" ng-class="{selected: convo.selected}" ng-Click="select(convo, 'tree')">

        <h2 ng-if="convo.type === 'Root'"><a href="{{convo.link}}">{{convo.title}}</a></h2>

        <div class="details">
          <h3>{{convo.author}}</h3>
          <h4>{{convo.time}}</h4>
        </div>
      
        <p>{{convo.contents}}</p>

        <div ng-slide="convo.selected" class="iconRack slideableH">
          <i ng-click="replying(convo)" class="replyIcon fa fa-comment-o fa-lg"></i>
          <i ng-click="debug(convo)" ng-show="development" class="debugIcon fa fa-question fa-lg"></i>
        </div>

      </div>

      <ul class="children">
        <li ng-repeat="convo in convo.children" ng-include="'treeRenderer'"></li>
        <li class="treeReply slideable" ng-slide="convo.replying" ng-include="'treeReplyRenderer'"></li>
      </ul>

    </div>
  </script>

  <script type="text/ng-template" id="treeReplyRenderer">
    <div class="treeView">
<!--      <div class="bracket rightBracket" ng-class="{leftBracket: convo.parent.children.length===0}"> -->
      <div class="node">
        <form ng-submit="reply(convo)">
          <textarea ng-model="convo.response" ng-focus="convo.replying" ng-enter="reply(convo)"></textarea>
        </form>
      </div>
    </div>
  </script>


  <!--                      -->
  <!--      Flow view       -->
  <!--                      -->

  <div ng-if="view==='flow'">
    <ul>
      <li class="flow" ng-repeat="flow in flows" ng-include="'flowRenderer'"></li>
    </ul>
  </div>


  <script type="text/ng-template" id="flowRenderer">
  <div class="flowView">

      <div class="bracket" ng-if="!flow.root" ng-class="{topBracket: $first, botBracket: $last}"></div>

      <div class="node" id="flow{{flow.node.token}}" ng-class="{selected: flow.selected, root: flow.root, anchor: flow.anchor}" ng-Click="select(flow, 'flow')">
    
        <h2 ng-if="flow.node.type === 'Root'"><a href="{{convo.link}}">{{convo.title}}</a></h2>

        <div class="details">
          <h3>{{flow.node.author}}</h3>
          <h4>{{flow.node.time}}</h4>
        </div>

        <div id="census" ng-show="flow.node.census - flow.flowbabies.length > 0">{{flow.node.census - flow.flowbabies.length}}</div>
      
        <p>{{flow.node.contents}}</p>

        <div ng-slide="flow.selected" class="iconRack slideableH">
          <i ng-click="replying(flow.node)" class="replyIcon fa fa-comment-o fa-lg"></i>
          <i ng-click="debug(flow.node)" ng-show="development" class="debugIcon fa fa-question fa-lg"></i>
        </div>

      </div>

      <ul class="children">
        <li class="animate-repeat" ng-repeat="flow in flow.flowbabies" ng-include="'flowRenderer'"></li>
        <li class="flowReply slideable" ng-slide="flow.node.replying" ng-include="'flowReplyRenderer'"></li>
      </ul>
    
    </div>
  </script>


  <script type="text/ng-template" id="flowReplyRenderer">
    <div class="flowView">
    
      <!-- <div class="bracket botBracket" ng-class="{topBracket: flow.node.parent.children === 0}"></div> -->

      <div class="node">
        <form ng-submit="reply(flow.node)">
          <textarea ng-model="flow.node.response" ng-focus="flow.node.replying" ng-enter="reply(flow.node)"></textarea>
        </form>
      </div>

    </div>
  </script>


  <!--                      -->
  <!--      Debug info      -->
  <!--                      -->

  <div class="debugView" ng-show="debugView" ng-click="closeDebug()">
    <ul>
      <li ng-repeat="convo in posts" ng-include="'debugRenderer'"></li>
    </ul>
  </div>


  <script type="text/ng-template" id="debugRenderer">
    <div class="debug" ng-show="convo.debug" ng-click="$event.stopPropagation()">
      <i ng-click="closeDebug()" class="closeDebug fa fa-minus-square-o fa-lg"></i>
      <ul>
        <li>Author: {{convo.author}}</li>
        <li>Timestamp: {{convo.timestamp}}</li>
        <li>Rendered Time: {{convo.time}}</li>
        <li>Token: {{convo.token}}</li>
        <li>Depth: {{convo.depth}}</li>
        <li>Contents: {{convo.contents}}</li>
      </ul>
    </div>
  </script>



</div>
